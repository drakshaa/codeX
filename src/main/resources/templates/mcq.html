<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>MCQ Round â€¢ CodeX</title>
    <link rel="stylesheet" th:href="@{/css/main.css}">

    <style>

        .mcq-container {
            max-width: 900px;
            margin: 6rem auto;
            padding: 0 24px;
            color: var(--text);
        }

        .mcq-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .mcq-header h1 {
            font-size: 38px;
            font-weight: 700;
        }

        .start-btn {
            margin-top: 20px;
            padding: 12px 24px;
            background: linear-gradient(180deg, var(--accent), #ff7b2a);
            border-radius: 30px;
            color: #1b0e00;
            cursor: pointer;
            font-weight: 600;
            border: none;
            box-shadow: 0 8px 24px rgba(255, 120, 50, .25);
        }

        .question-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            border: 1px solid rgba(255,255,255,0.06);
            box-shadow: 0 0 25px rgba(255, 145, 77, 0.08);
            backdrop-filter: blur(8px);
        }

        .options label {
            display: block;
            margin: 10px 0;
            padding: 10px;
            border-radius: 10px;
            cursor: pointer;
            background: rgba(255,255,255,0.08);
            transition: 0.2s ease;
        }

        .options label:hover {
            background: rgba(255,145,77,0.2);
        }

        .submit-btn {
            padding: 14px 28px;
            border-radius: 30px;
            background: var(--accent);
            color: #1b0e00;
            border: none;
            font-weight: 600;
            cursor: pointer;
            margin: 24px auto;
            display: block;
            box-shadow: 0 8px 24px rgba(255, 120, 50, .25);
        }

        .score-popup {
            position: fixed;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255,255,255,0.1);
            padding: 30px;
            border-radius: 18px;
            backdrop-filter: blur(10px);
            text-align: center;
            color: white;
            width: 350px;
            display: none;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 0 40px rgba(255,145,77,0.2);
        }

    </style>
</head>

<body>

<header class="navbar">
    <div class="logo">CODEX</div>

    <nav class="nav-links">
        <a th:href="@{/home}">Home</a>
        <a th:href="@{/about}">About</a>
        <a th:href="@{/register}">Register</a>
    </nav>

    <div class="nav-spacer"></div>

    <div class="profile" th:if="${session.activeuser != null}">
        <img th:src="@{/images/user.png}" class="profile-icon">
    </div>

    <a class="btn btn-login" th:if="${session.activeuser == null}" th:href="@{/login}">Login</a>
</header>


<div class="mcq-container">

    <div class="mcq-header">
        <h1>MCQ Practice Round</h1>
        <p>Click below to start a fresh MCQ round generated just for you.</p>
        <button class="start-btn" onclick="startRound()">Start Round</button>
    </div>

    <div id="questions-area"></div>

    <button id="submit-btn" class="submit-btn" onclick="submitAnswers()" style="display:none;">
        Submit Answers
    </button>
</div>

<!-- Score Popup -->
<div id="score-popup" class="score-popup">
    <h2>Your Score</h2>
    <p id="score-value" style="font-size: 30px; margin: 10px 0;"></p>
    <button class="btn btn-cta" onclick="closePopup()">Close</button>
</div>


<script>

    let roundId = null;
    let questions = [];

    async function startRound() {
        const response = await fetch('/api/mcq/round', { method: "POST" });
        const json = await response.json();

        questions = json.data.questions;
        roundId = json.data.roundId;

        renderQuestions();
    }

    function renderQuestions() {
        const container = document.getElementById("questions-area");
        container.innerHTML = "";

        questions.forEach((q, index) => {
            container.innerHTML += `
                <div class="question-card">
                    <h3>${index + 1}. ${q.question}</h3>
                    <div class="options">
                        ${q.options.map((opt, i) => `
                            <label>
                                <input type="radio" name="q${index}" value="${i}">
                                ${opt}
                            </label>
                        `).join("")}
                    </div>
                </div>
            `;
        });

        document.getElementById("submit-btn").style.display = "block";
    }

    async function submitAnswers() {

        let answers = [];

        questions.forEach((q, index) => {
            let selected = document.querySelector(`input[name="q${index}"]:checked`);
            answers.push(selected ? parseInt(selected.value) : -1);
        });

        const res = await fetch('/api/mcq/submit', {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({
                roundId: roundId,
                answers: answers
            })
        });

        const json = await res.json();
        showScore(json.data);
    }

    function showScore(score) {
        document.getElementById("score-value").innerHTML = score + "%";
        document.getElementById("score-popup").style.display = "block";
    }

    function closePopup() {
        document.getElementById("score-popup").style.display = "none";
    }

</script>

</body>
</html>
