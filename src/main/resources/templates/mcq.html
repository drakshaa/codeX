<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <title>MCQ Round • Live Assessment</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <style>
        body { background: #1a1a2e; color: #fff; }
        .assessment-container { max-width: 900px; margin: 40px auto; }
        .question-card { background: #2a2a44; border-radius: 12px; padding: 30px; margin-bottom: 30px; }
        .timer-box { background: #ff7f41; color: #fff; padding: 10px 20px; border-radius: 8px; font-size: 1.5rem; font-weight: bold; position: fixed; top: 20px; right: 20px; z-index: 100; box-shadow: 0 4px 10px rgba(0,0,0,0.5); }
        h1, h2 { color: #ff7f41; text-align: center; margin-bottom: 20px; }
        .mcq-option { margin-bottom: 15px; position: relative; }
        
       
        .mcq-option input[type="radio"] {
            position: absolute;
            opacity: 0;
            width: 100%; 
            height: 100%;
            top: 0;
            left: 0;
            z-index: 2; 
            cursor: pointer;
        }

      
        .mcq-option label { 
            display: block; 
            padding: 15px; 
            border-radius: 8px; 
            border: 1px solid #4a4a66; 
            transition: background-color 0.2s, border-color 0.2s; 
            z-index: 1; 
            position: relative;
        }
        
       
        .mcq-option input[type="radio"]:checked + label {
            background-color: #ff7f4133;
            border-color: #ff7f41;
            color: #ff7f41; 
        }
        
        .mcq-option label:hover { 
            background-color: #3a3a5a; 
        }
        
        .code-input { background: #1e1e2d; color: #f8f8f2; border: 1px solid #4a4a66; padding: 15px; font-family: monospace; height: 300px; resize: vertical; }
    </style>
</head>
<body>

    <div class="timer-box" id="timer">
        <i class="fas fa-clock mr-2"></i> 00:00:00
    </div>

    <div class="assessment-container">
        <h1>MCQ Round • Live Assessment</h1>
        <p class="text-center text-muted">Question <span th:text="${currentIndex}"></span> of <span th:text="${totalQuestions}"></span></p>

        <form th:action="@{/mcq/next}" method="post" id="assessmentForm">
            <div class="question-card">
                <h4 th:text="${currentIndex} + '. ' + ${question.text}">1. Which time complexity is better?</h4>

                <div th:if="${question.type == 'MCQ'}">
                    <p class="text-warning">Select the best option:</p>
                    
                    <div th:each="option, stat : ${question.options}" class="mcq-option">
                        <th:block th:with="optionId=${'q' + question.id + '_opt' + stat.index}">
                            
                            <input type="radio" th:id="${optionId}" name="answer" th:value="${option}" required>
                            <label th:for="${optionId}" th:text="${option}"></label>
                        
                        </th:block>
                    </div>
                </div>

                <div th:if="${question.type == 'DSA'}">
                    <p class="text-info">Write your code solution below:</p>
                    <textarea name="answer" class="form-control code-input" placeholder="// Write your solution here..." required></textarea>
                    <small class="form-text text-muted mt-2">Submit clean, runnable code for evaluation.</small>
                </div>
                
            </div>

            <button type="submit" class="btn btn-block btn-lg" style="background-color: #ff7f41; color: #fff;">
                Submit & Next Question 
            </button>
        </form>

    </div>

    <script>
        // Data passed from the server
        const totalTimeMinutes = [[${totalTime}]];
        const startTime = [[${session.startTime}]];
        const totalDurationMillis = totalTimeMinutes * 60 * 1000;
        const form = document.getElementById('assessmentForm');
        const timerElement = document.getElementById('timer');

        function updateTimer() {
            const currentTime = new Date().getTime();
            const elapsed = currentTime - startTime;
            const remaining = totalDurationMillis - elapsed;

            if (remaining <= 0) {
                // Time's up! Auto-submit the form
                timerElement.innerHTML = '<i class="fas fa-exclamation-triangle mr-2"></i> TIME UP!';
                clearInterval(timerInterval);
                form.action = "[[@{/mcq/submit-round}]]"; // Change action to final submission endpoint
                form.submit();
                return;
            }

            // Convert remaining milliseconds to HH:MM:SS
            const hours = Math.floor(remaining / (1000 * 60 * 60));
            const minutes = Math.floor((remaining % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((remaining % (1000 * 60)) / 1000);

            const display = 
                String(hours).padStart(2, '0') + ":" + 
                String(minutes).padStart(2, '0') + ":" + 
                String(seconds).padStart(2, '0');

            timerElement.innerHTML = `<i class="fas fa-clock mr-2"></i> ${display}`;
        }

        // Start the timer update every second
        const timerInterval = setInterval(updateTimer, 1000);

        // Initial call to display time immediately
        updateTimer();
    </script>
    
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

</body>
</html>